<style>
  body {
    padding-top: 72px;
  }
</style>
<header id="formbarHeader">
  <a href="/" id="headerLogo">Formbar</a>
  <% if (locals.currentUser) { %>
    <% if (currentUser.classPermissions) {%>
            <a href=<%- currentUser.classPermissions >= 4 ? "/controlPanel" : "/student" %> class="headerTab">Panel</a>
    <% } %>
        <% if (currentUser.permissions>= MANAGER_PERMISSIONS) { %>
          <a href="/managerPanel" class="headerTab">Manager</a>
          <% } %>
            <% if (!currentUser.classPermissions) { %>
              <% if (currentUser.permissions>= TEACHER_PERMISSIONS) { %>
                <a href="/manageClass" class="headerTab">Manage Class</a>
                <% } %>
                  <a href="/selectClass" class="headerTab">Join Class</a>
                  <% } %>
                        <% if (currentUser.classPermissions) { %>
                          <button href="/" class="headerTab" title="Change class" onclick="leaveClass()">Change Class</button>

                            <button href="/" class="headerTab" title="Leave classroom" onclick="leaveClassroom()">Leave Classroom</button>
                          <% } %>
                            <button href="/" id="logoutButton" onclick="logout()">
                              <img id="logoutIcon" src="/img/logout.svg" title="Logout">
                            </button>
                            <% } %>
                            <p id="version">v 1.1.0</p>
                            <button onclick="toggleTheme()" id="lmdmBtn" title="LM/DM">
                              <img id="lmdmIcon" src="/img/sun.svg">
                            </button>
                            <button id="muteButton" onclick="toggleMuteSound()"><img id="muteIcon" src="img/volume.svg"></button>
                            <button id="unmuteButton" onclick="toggleMuteSound()" hidden><img id="unmuteIcon" src="img/mute.svg"></button>
</header>
<script>
  let lmdmIcon = document.getElementById("lmdmIcon");

  //document.body.style.backgroundColor = getCookie("theme")
  if (getCookie("theme") == "white") {
    document.getElementById('lmdm').href = '/css/lightmode.css';
    lmdmIcon.src = "/img/moon.svg"
  } else if (getCookie("theme") == "dark") {
    document.getElementById('lmdm').href = '/css/darkmode.css';
    lmdmIcon.src = "/img/sun.svg"
  }

  function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length >= 2) return parts.pop().split(';').shift();
  }

  var nextYear = new Date().getFullYear() + 1;

  function toggleTheme() {
    let theme = getCookie("theme");
    if (!theme) theme = "white"; // If no theme cookie, default to white
    if (theme === "white") {
      document.cookie = "theme=dark;expires=Fri, 1 Jul " + nextYear + " 23:59:59 GMT; path=/";
      document.getElementById('lmdm').href = '/css/darkmode.css';
      lmdmIcon.src = "/img/sun.svg"
    } else {
      document.cookie = "theme=white;expires=Fri, 1 Jul " + nextYear + " 23:59:59 GMT; path=/";
      document.getElementById('lmdm').href = '/css/lightmode.css';
      lmdmIcon.src = "/img/moon.svg";
    }
  }

  function logout() {
    if (confirm('Are you sure you want to logout?')) {
      socket.emit('logout')
    }
  }

  function leaveClass() {
    if (confirm('Are you sure you want to change classes? This will remove you from the current class session.')) {
      socket.emit('leaveClass')
    }
  }

  function leaveClassroom() {
    if (confirm('Are you sure you want to leave the classroom?')) { 
      socket.emit('leaveClassroom') 
    }
  }

  if (currentUser && currentUser.activeClasses.length > 0 && currentUser.permissions >= MOD_PERMISSIONS) {
      const muteButton = document.getElementById("muteButton");
      muteButton.style.display = "block";
  }
</script>