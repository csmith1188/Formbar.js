<%- include('../partials/header_content') %>
    <%- include('../partials/sockets') %>
    <%- include('../partials/formbar_header') %>
    <style>
        #apiKey {
            white-space: pre;
        }
    </style>
        <body style="display: flex;" role="document" tabindex="0">
            <div id='profileInformation' class="revampDiv">
                <h1>Profile Information</h1>
                <p id='displayName''><strong>Display Name:</strong> <%- displayName %></p>

                <% if (email !== "Hidden") { %> <!-- If the user doesn't have permissions to see the email, don't show it -->
                    <p id="email"><strong>Email:</strong> <%- email %></p>
                <% } %>

                <p id='digipogs''><strong>Digipogs:</strong> <%- digipogs %></p>
                <p id='userId''><strong>ID:</strong> <%- id %></p>
                <p id='apiKey'><strong>API Key:</strong> █</p>
                <div id='apiKeyButton'>
                    <button onclick="copyApiKey()" class="revampButton">
                        Copy API Key
                    </button>
                    <button id="showHideApi" onclick="revealApiKey()" class="revampButton">
                        Reveal API Key
                    </button>
                    <button id='apiRefresh' onclick='refreshApiKey()' class="revampButton warningButton">
                        Refresh API Key
                    </button>
                </div>
            </div>
        </body>
        <script>
            let apiKeyValue = '<%- API %>';
            if (apiKeyValue == '') {
                document.querySelectorAll('[id*="api"]').forEach(element => {
                    element.remove();
                });
            }

            let apiKey = document.getElementById('apiKey');
                
            function copyApiKey() {
                navigator.clipboard.writeText(apiKeyValue);
            }

            function revealApiKey() {
                let showHideApi = document.getElementById('showHideApi');
                apiKey.innerHTML = '<strong>API Key:</strong> ' + apiKeyValue;
                showHideApi.setAttribute("onclick", "hideApiKey()");
                showHideApi.innerText = 'Hide API Key';
            }

            function hideApiKey() {
                let showHideApi = document.getElementById('showHideApi');

                apiKey.innerHTML = `<strong>API Key:</strong> ${'█'.repeat(apiKeyValue.length / 2)}`;
                showHideApi.setAttribute("onclick", "revealApiKey()");
                showHideApi.innerText = 'Reveal API Key';
            }

            hideApiKey();

            function refreshApiKey() {
                if(confirm("Are you sure you want to refresh your API key? This action cannot be undone.")) socket.emit('refreshApiKey');
            }
            
            socket.on('apiKeyUpdated', (data) => {
                apiKeyValue = data;
                const apiKey = document.getElementById('apiKey');
                const apiKeyButton = document.getElementById('apiKeyButton');
                if (apiKeyButton.innerHTML.includes('Hide API Key')) {
                    apiKey.innerHTML = '<p><strong>API Key:</strong> ' + apiKeyValue + '</p>';
                } else {
                    apiKey.innerHTML = '<p id="apiKey"><strong>API Key:</strong> ████████████████████████████████████████████████████████████████</p>';
                }
            });
        </script>