<!DOCTYPE html>
<%- include('../partials/header_content') %>

        <html lang="en">

        <head>
            <style>
                body {
                    padding-top: 52px !important;
                }

                td, th {
                    padding: 20px 35px;
                    border-bottom: 2px solid var(--lightMode-menu-border);
                }

                table {
                    outline: none !important;
                    border-spacing: 0;
                }

                div.transactionHistory {
                    width: 100%;
                    height: 100vh;
                    display: flex;
                    justify-content: start;
                    align-items: center;
                    overflow: scroll;
                    flex-direction: column;
                    padding: 5px 0 60px 0;
                }
                
                .buttons {
                    display: flex;
                    flex-direction: row;
                    gap: 10px;
                    margin-top: 10px;
                }

            </style>
        </head>

        <body role="document" tabindex="0">
            <%- include('../partials/formbar_header') %>

            
            <div class="transactionHistory">
                <h1>Transactions for <%- displayName %></h1>

                <% if (transactions.length === 0) { %>
                    <p style="margin-top: 30px; font-size: 18px; color: #666;">No transactions found for this user.</p>
                <% } else { %>

                <table class="revampDiv">
                    <tr>
                        <th class="hideMobile">From:</th>
                        <th class="hideMobile">To:</th>
                        <th>Amount</th>
                        <th>Reason</th>
                        <th class="hideMobile">Date</th>
                    </tr>

                    <% for(let i=0; i < transactions.length; i++) { %>
                        <%
                            let transaction = transactions[i];
                            let page = Math.floor(i / 10);
                            const date = new Date(Number(transaction.date));
                            const valid = !isNaN(date);
                        %>
                        <tr data-page="<%- page %>" style="display: none;">
                            <td class="hideMobile"><%= transaction.from_user ? transaction.from_user : 'Pool: ' + transaction.pool %></td>
                            <td class="hideMobile"><%= transaction.to_user ? transaction.to_user : 'Pool: ' + transaction.pool %></td>
                            <td class="hideMobile"><%= transaction.amount %></td>
                            <td class="showMobileCell"><%= transaction.amount %></td>
                            <td><%= transaction.reason %></td>
                            <td class="hideMobile"><%= valid ? `${date.toLocaleDateString()} at ${date.toLocaleTimeString()}` : 'Not tracked' %></td>
                        </tr>
                    <% } %>
                </table>

                <p style="margin-top: 10px; font-size: 16px;">Page: 1 / 1</p>

                <div class="buttons">
                    <button onclick="lastPage()" id="backButton" class="revampButton">&lt;&lt;</button>
                    <button onclick="nextPage()" id="forwardButton" class="revampButton">&gt;&gt;</button>
                </div>

                <% } %>

                <button class="revampButton" style="position: fixed; bottom: 20px; left: 20px; padding: 15px 25px; font-size: 18px;" onclick="location.href = '/pools'">
                    Pog Pools
                </button>
            </div>
        </body>
        
        <% if (transactions.length > 0) { %>        
        <script>
            let backButton = document.getElementById('backButton');
            let forwardButton = document.getElementById('forwardButton');

            let trans = <%- JSON.stringify(transactions) %>

            let currentPage = 0;
            const totalPages = Math.ceil(<%- transactions.length %> / 10);
            
            function showPage(page) {
                document.querySelectorAll('tr[data-page]').forEach(row => {
                    row.style.display = 'none';
                });
                
                document.querySelectorAll(`tr[data-page="${page}"]`).forEach(row => {
                    row.style.display = '';
                });
                
                document.querySelector('p').innerText = `Page: ${page + 1} / ${totalPages}`;

                currentPage == 0 ? backButton.style.display = 'none' : backButton.style.display = 'block';
                currentPage == totalPages - 1 ? forwardButton.style.display = 'none' : forwardButton.style.display = 'block';
            }
            
            function nextPage() {
                if (currentPage < totalPages - 1) {
                    currentPage++;
                    showPage(currentPage);
                }
            }
            
            function lastPage() {
                if (currentPage > 0) {
                    currentPage--;
                    showPage(currentPage);
                }
            }
            
            showPage(0);
        </script>
        <% } %>
</html>